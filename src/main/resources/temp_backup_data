# Create table HEALTHCARE_UNIT
CREATE TABLE healthcare_unit (
    id integer NOT NULL,
    unit_name character varying(256) NOT NULL,
    address character varying(256) NOT NULL,
    postal_code character varying(256) NOT NULL,
    city character varying(256) NOT NULL
);

ALTER TABLE ONLY healthcare_unit
    ADD CONSTRAINT healthcare_unit_pkey PRIMARY KEY (id);

INSERT INTO public.healthcare_unit(
	id, unit_name, address, postal_code, city)
	VALUES (1, 'InfoSyf', 'Rondo Solidarnosci', '00-00', 'Lodz');

# Create table DOCTOR
CREATE TABLE doctor (
    id integer NOT NULL,
    healthcare_unit_id integer NOT NULL,
    email character varying(256) NOT NULL,
    password character varying(256) NOT NULL,
    first_name character varying NOT NULL,
    last_name character varying(256) NOT NULL,
    birth_date date NOT NULL,
    pesel character varying(11) NOT NULL,
    specialisation character varying(256) NOT NULL,
    phone_number character varying(256) NOT NULL
);

ALTER TABLE ONLY doctor
    ADD CONSTRAINT doctor_pkey PRIMARY KEY (id);

ALTER TABLE ONLY doctor
    ADD CONSTRAINT healthcare_unit_fk FOREIGN KEY (healthcare_unit_id) REFERENCES healthcare_unit(id);

INSERT INTO public.doctor(
	id, healthcare_unit_id, email, password, first_name, last_name, birth_date, pesel, specialisation, phone_number)
	VALUES (1, 1, 'szymar95@gmail.com', 'testpass', 'Szymon', 'Marciniak', '1995-11-28', '95112800000', 'oncologist', '000000000');

# Create table PATIENT
CREATE TABLE patient (
    id integer NOT NULL,
    email character varying(256) NOT NULL,
    password character varying(256) NOT NULL,
    first_name character varying(256) NOT NULL,
    last_name character varying(256) NOT NULL,
    birth_date date NOT NULL,
    pesel character varying(11) NOT NULL,
    phone_number character varying(256) NOT NULL
);

ALTER TABLE ONLY patient
    ADD CONSTRAINT patient_pkey PRIMARY KEY (id);

# Create table PRESCRIPTION
CREATE TABLE prescription (
    id integer NOT NULL,
    patient_id integer NOT NULL,
    doctor_id integer NOT NULL,
    healthcare_unit_id integer NOT NULL,
    date_of_issue date NOT NULL,
    date_of_expiration date NOT NULL,
    content text NOT NULL
);

ALTER TABLE ONLY prescription
    ADD CONSTRAINT prescription_pkey PRIMARY KEY (id);

ALTER TABLE ONLY prescription
    ADD CONSTRAINT doctor_fk FOREIGN KEY (doctor_id) REFERENCES doctor(id);

ALTER TABLE ONLY prescription
    ADD CONSTRAINT healthcare_unit_fk FOREIGN KEY (healthcare_unit_id) REFERENCES healthcare_unit(id);

ALTER TABLE ONLY prescription
    ADD CONSTRAINT patient_fk FOREIGN KEY (patient_id) REFERENCES patient(id);

INSERT INTO public.prescription(
	id, patient_id, doctor_id, healthcare_unit_id, date_of_issue, date_of_expiration, content)
	VALUES (1, 1, 1, 1, '2018-11-25', '2018-12-09', 'xanax 5mg, marijuana 10g weekly');

# Create table VISIT
CREATE TABLE visit (
    id integer NOT NULL,
    patient_id integer NOT NULL,
    doctor_id integer NOT NULL,
    healthcare_unit_id integer NOT NULL,
    visit_date date NOT NULL,
    symptoms text,
    diagnosis text,
    status character varying(256) NOT NULL
);

ALTER TABLE ONLY visit
    ADD CONSTRAINT visit_pkey PRIMARY KEY (id);

ALTER TABLE ONLY visit
    ADD CONSTRAINT doctor_fk FOREIGN KEY (doctor_id) REFERENCES doctor(id);

ALTER TABLE ONLY visit
    ADD CONSTRAINT healthcare_unit_fk FOREIGN KEY (healthcare_unit_id) REFERENCES healthcare_unit(id);

ALTER TABLE ONLY visit
    ADD CONSTRAINT patient_fk FOREIGN KEY (patient_id) REFERENCES patient(id);

INSERT INTO public.visit(
	id, patient_id, doctor_id, healthcare_unit_id, visit_date, symptoms, diagnosis, status)
	VALUES (1, 1, 1, 1, '2018-11-28', 'headache, fever', 'niedojebanie mozgowe', 'AWATING');

CREATE TABLE visit_prescription (
    visit_id integer,
    prescription_id integer
);

ALTER TABLE ONLY visit_prescription
    ADD CONSTRAINT prescription_fk FOREIGN KEY (prescription_id) REFERENCES prescription(id);

ALTER TABLE ONLY visit_prescription
    ADD CONSTRAINT visit_fk FOREIGN KEY (visit_id) REFERENCES visit(id);

INSERT INTO public.visit_prescription(
	visit_id, prescription_id)
	VALUES (1, 1);